# [22-6] Node Advanced Properties and Accordion System

[Back to task list](./tasks.md)

## Description

Add advanced node properties (combine method, image, palette item, source app) with collapsible accordion sections. This task extends the basic node management interface from Task 22-5 by adding a secondary accordion section for advanced properties that are less commonly used but still needed for comprehensive node configuration.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-26 23:00:00 | Created | N/A | Proposed | Task file created for advanced node properties and accordion system | AI_Agent |
| 2025-01-26 23:05:00 | Status Update | Proposed | Agreed | Task approved for implementation | AI_Agent |
| 2025-01-26 23:10:00 | Status Update | Agreed | InProgress | Started implementation of advanced node properties | AI_Agent |
| 2025-01-26 23:30:00 | Status Update | InProgress | Done | Advanced properties accordion implemented with validation and styling - Added combineMethod, image, usesDefaultImage, paletteItem, sourceApp fields to NodeProperties interface, enhanced NodePropertiesForm with collapsible Advanced Properties accordion section, implemented URL validation for image field and string length validation for text fields, added comprehensive CSS styling for accordion sections, integrated accordion state management. All advanced properties now included in form data collection and node operations. | AI_Agent |

## Requirements

### Primary Requirements
1. **Advanced Properties Accordion Section**
   - Collapsible accordion within the existing Node Properties section
   - Initially collapsed by default (as per reference plugin)
   - Proper toggle functionality with visual indicators

2. **Advanced Property Fields**
   - **combineMethod** (string): Text input for combine method specification
   - **image** (string): Text input for image URL
   - **usesDefaultImage** (boolean): Checkbox for default image usage
   - **paletteItem** (string): Text input for palette item identifier
   - **sourceApp** (string): Text input for source application identifier

3. **Form Integration**
   - Seamless integration with existing NodePropertiesForm
   - Proper form validation and change tracking
   - Integration with existing node creation and update operations

4. **State Management**
   - Advanced properties included in node data collection
   - Proper form population when nodes are selected
   - Change tracking for update button state management

5. **Visual Design**
   - Consistent styling with existing accordion sections
   - Proper spacing and visual hierarchy
   - Clear visual distinction between basic and advanced properties

### Secondary Requirements
1. **Accordion Behavior**
   - Smooth expand/collapse animations
   - Proper arrow indicator rotation
   - Keyboard accessibility support

2. **Property Validation**
   - URL validation for image field
   - Appropriate string length limits
   - Required field validation where applicable

3. **User Experience**
   - Clear labels and placeholder text
   - Tooltips or help text for complex properties
   - Logical grouping of related properties

## Implementation Plan

### Phase 1: Accordion Component Enhancement
1. Enhance existing Accordion component to support nested accordions
2. Add proper styling for nested accordion sections
3. Implement state management for multiple accordion sections

### Phase 2: Advanced Properties Form Section
1. Create NodeAdvancedPropertiesForm component
2. Implement all advanced property fields with proper types
3. Add form validation and change tracking

### Phase 3: Integration with NodePropertiesForm
1. Integrate advanced properties section into existing form
2. Update node data collection to include advanced properties
3. Enhance form population logic for advanced properties

### Phase 4: State Management Integration
1. Update NodePropertiesForm to handle advanced properties
2. Integrate with existing change tracking system
3. Update MCP tool calls to include advanced properties

## Test Plan

### Unit Tests
- Advanced property field validation
- Accordion state management
- Form data collection including advanced properties
- Change tracking with advanced properties

### Integration Tests
- Node creation with advanced properties
- Node update operations including advanced properties
- Form population from API responses with advanced properties
- Accordion expand/collapse behavior

### UI Tests
- Accordion visual behavior and animations
- Advanced property field validation messages
- Form submission with advanced properties
- Change tracking accuracy with advanced properties

## Verification

### Success Criteria
1. Advanced Properties accordion section is properly integrated
2. All advanced property fields are functional and validated
3. Form data collection includes advanced properties
4. Node operations (create/update) work with advanced properties
5. Accordion expand/collapse behavior works correctly
6. Change tracking includes advanced properties
7. Form population includes advanced properties when selecting nodes

### Acceptance Tests
1. Create a new node with advanced properties set
2. Update an existing node's advanced properties
3. Verify accordion expand/collapse behavior
4. Test form validation for advanced property fields
5. Verify advanced properties are included in API calls
6. Test form population when selecting nodes with advanced properties

## Dependencies

### Internal Dependencies
- Task 22-5: Node Management UI and Basic Properties (completed)
- Task 22-3: Base Component Structure and Styling (for accordion styling)
- Task 22-4: MCP Tool Execution Framework (for API calls)

### External Dependencies
- Existing Accordion component functionality
- NodePropertiesForm component from Task 22-5
- MCP tool infrastructure for node operations

## Files Modified

### Modified Files
- `src/components/tabs/NodePropertiesForm.tsx` (add advanced properties)
- `src/components/tabs/Accordion.tsx` (enhance for nested accordions)
- `src/components/SageModelerAPIPanel.css` (accordion styling)
- `src/types/tabs.ts` (add advanced property types)

### Potential New Files
- `src/components/tabs/NodeAdvancedPropertiesForm.tsx` (if separate component needed)

## Notes

This task builds upon the solid foundation established in Task 22-5 by adding the advanced properties that complete the comprehensive node management interface. The accordion system provides a clean way to organize the interface, keeping basic properties visible while allowing access to advanced features when needed.

The implementation should maintain consistency with the existing design patterns and ensure that all advanced properties are properly handled throughout the entire node management workflow. 