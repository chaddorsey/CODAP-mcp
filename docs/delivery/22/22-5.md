# 22-5 Implement Message Relay for SageModeler API Tester

[Back to task list](./tasks.md)

## Description
Add logic to the main plugin to relay postMessage events from the embedded SageAPI tester iframe to the main CODAP window/SageModeler plugin, and vice versa if needed. This ensures that actions taken in the SageAPI tester (such as creating nodes) are properly communicated to the SageModeler plugin for execution and response.

**This relay logic must leverage the existing message relay infrastructure in AppDualMode.tsx, centralizing all message handling (from both the browser worker and the SageModeler API Tester iframe) in one place. The relay should use the CODAP Plugin API or existing relay logic to forward messages, following DRY and maintainable architecture principles.**

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-20 10:00:00 | Created | N/A | InProgress | Task file created and work started | AI_Agent |
| 2025-01-20 10:30:00 | Implementation Plan Updated | InProgress | InProgress | Updated to leverage existing relay infrastructure in AppDualMode.tsx | AI_Agent |

## Requirements
- Listen for postMessage events from the SageAPI tester iframe
- Relay relevant messages to the SageModeler plugin (or CODAP window) using the existing relay/message handling logic in AppDualMode.tsx
- Optionally, relay responses back to the tester iframe
- Ensure security by validating message origins and types
- Centralize all message relaying in AppDualMode.tsx for maintainability
- Test that actions in the tester result in expected changes in SageModeler

## Implementation Plan
1. Add a message event listener in AppDualMode.tsx to capture messages from the SageAPI tester iframe
2. Refactor or extend the existing message relay logic in AppDualMode.tsx to handle messages from both the browser worker and the SageAPI tester iframe
3. Use the CODAP Plugin API or existing relay logic to forward messages to the SageModeler plugin or CODAP
4. Optionally, handle responses and relay them back to the tester iframe
5. Test end-to-end communication

## Verification
- Confirm that clicking 'Create Random Node' in the tester results in a node being created in SageModeler
- Confirm that other API actions are relayed and executed
- Confirm that no security or infinite loop issues occur
- Confirm that all message relaying is centralized in AppDualMode.tsx

## Files Modified
- src/components/AppDualMode.tsx (relay logic)
- docs/delivery/22/tasks.md (this task added)
- docs/delivery/22/22-5.md (this file) 