# [22-5] Node Management UI and Basic Properties

[Back to task list](./tasks.md)

## Description

Implement comprehensive node property controls including title, initial value, position, color, and basic flags. This task focuses on creating the foundational node management interface with proper form controls, validation, and integration with the existing tab system.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-01-06 13:30:00 | Created | N/A | Proposed | Task file created for comprehensive node management UI and basic properties implementation | AI_Agent |
| 2025-01-06 13:35:00 | Status Update | Proposed | InProgress | Started implementation of comprehensive node management UI and basic properties | AI_Agent |
| 2025-01-06 14:30:00 | Status Update | InProgress | Done | Complete node management UI implemented - Created comprehensive NodePropertiesForm with validation for all node properties (title, values, position, color, flags), NodeCreationControls for creating new and random nodes, NodeSelectionList for selecting and managing nodes, and integrated NodesTab component that coordinates all functionality. Updated SageModelerAPIPanel to use new NodesTab component, removing legacy node management code. All node operations now use standardized MCP tool calls with proper error handling and status updates. | AI_Agent |

## Requirements

### Primary Requirements
1. **Node Property Form Implementation**
   - Title input field with validation
   - Initial value numeric input with proper formatting
   - Position controls (X, Y coordinates)
   - Color selector with predefined options
   - Boolean flags for basic node properties

2. **Node Creation Controls**
   - Create New Node button with form data
   - Create Random Node button for quick testing
   - Form validation and error messaging
   - Success feedback and node ID tracking

3. **Node Selection and Management**
   - Node selection dropdown/list
   - Selected node highlighting and tracking
   - Form population when nodes are selected
   - Clear selection functionality

4. **Property Change Tracking**
   - Track form modifications to enable/disable update button
   - Visual indicators for unsaved changes
   - Proper state management for form fields

5. **Basic Property Categories**
   - **Core Properties**: title, initialValue, x, y, color
   - **Boolean Flags**: isAccumulator, isFlowVariable, allowNegativeValues
   - **Validation Properties**: min, max values
   - **Visual Properties**: color selection with SageModeler palette

### Secondary Requirements
1. **Form Validation**
   - Required field validation
   - Numeric field validation with appropriate ranges
   - Title uniqueness checking
   - Position boundary validation

2. **State Management Integration**
   - Integration with existing tab system state
   - Proper form reset on tab/subtab changes
   - State persistence during navigation

3. **Error Handling**
   - Form validation error display
   - API error handling and user feedback
   - Graceful degradation for missing data

## Implementation Plan

### Phase 1: Basic Form Structure
1. Create NodePropertiesForm component
2. Implement basic input fields with proper TypeScript types
3. Add form validation logic
4. Integrate with existing Nodes sub-tab

### Phase 2: Node Creation Controls
1. Add Create New Node functionality
2. Add Create Random Node functionality
3. Implement form data collection and validation
4. Add success/error feedback

### Phase 3: Selection Management
1. Implement node selection dropdown
2. Add form population from selected node
3. Implement change tracking for update button
4. Add clear selection functionality

### Phase 4: Property Categories
1. Organize properties into logical groups
2. Add color picker with SageModeler palette
3. Implement boolean flag controls
4. Add position controls with validation

## Test Plan

### Unit Tests
- Form validation logic
- Property change tracking
- Node data collection and transformation
- Error handling scenarios

### Integration Tests
- Node creation via MCP tools
- Form population from API responses
- Tab system integration
- State management during navigation

### UI Tests
- Form field validation messages
- Button state changes based on form status
- Color picker functionality
- Position control validation

## Verification

### Success Criteria
1. All basic node properties are editable through form controls
2. Create New Node and Create Random Node buttons work correctly
3. Node selection populates form fields accurately
4. Form validation prevents invalid data submission
5. Update button is enabled/disabled based on form changes
6. Color picker offers appropriate SageModeler color options
7. Position controls accept valid coordinate ranges
8. Boolean flags toggle correctly and reflect in node properties

### Acceptance Tests
1. Create a new node with custom properties
2. Select an existing node and verify form population
3. Modify node properties and verify update functionality
4. Test form validation with invalid inputs
5. Verify color selection reflects in created nodes
6. Test position controls with boundary conditions
7. Validate boolean flags affect node behavior

## Dependencies

### Internal Dependencies
- Task 22-2: Core Tab System Architecture (for tab integration)
- Task 22-3: Base Component Structure and Styling (for styling)
- Task 22-4: MCP Tool Execution Framework (for API calls)

### External Dependencies
- Existing MCP tool infrastructure
- SageModeler API for node operations
- Browser Worker Service for tool execution

## Files Modified

### New Files
- `src/components/tabs/NodePropertiesForm.tsx`
- `src/components/tabs/NodeCreationControls.tsx`
- `src/components/tabs/NodeSelectionList.tsx`

### Modified Files
- `src/components/tabs/TabSystem.tsx` (integration)
- `src/components/tabs/index.ts` (exports)
- `src/components/SageModelerAPIPanel.tsx` (state management)
- `src/types/tabs.ts` (type definitions)

## Notes

This task establishes the foundation for comprehensive node management in the SageModeler plugin. The implementation prioritizes usability, validation, and integration with existing MCP tools while maintaining the visual design established in previous tasks. 