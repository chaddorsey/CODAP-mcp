# 1-5 Integration tests for relay happy path

[Back to task list](./tasks.md)

## Description
Write Jest (supertest) integration tests that spin up the edge functions locally (via Vercel dev or mocked handlers) and verify the full round-trip: session creation → LLM request → SSE delivery → browser response.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| <!-- TIMESTAMP --> | Created | N/A | Proposed | Task file created | ai-agent |

## Requirements
* Test creates session and asserts code format.
* Test posts tool request and listens on SSE for matching message.
* Test posts response and verifies it is stored.
* All network calls mocked / local – no external latency.

## Implementation Plan
1. Use `@vercel/edge-functions-testing` (or local mocks) to invoke handlers.
2. Use `supertest` for HTTP requests.
3. Use `eventsource-parser` to consume SSE stream.
4. Ensure `npm test` runs integration in CI.

## Verification
* All tests green in CI.
* Failure cases (bad code) return 400.

## Files Modified
* `src/test/relay/happy-path.test.ts` (new) 