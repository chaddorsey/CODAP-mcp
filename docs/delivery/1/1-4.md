# 1-4 Implement request/response endpoints & KV

[Back to task list](./tasks.md)

## Description
Implement LLM-facing `POST /request` and browser-facing `POST /response` Edge Functions plus KV structures for message queues.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| <!-- TIMESTAMP --> | Created | N/A | Proposed | Task file created | ai-agent |

## Requirements
* `POST /request` body `{ code, id, tool, args }` validates against zod schema.
* Store request in `req::<code>` list in KV.
* `POST /response` body `{ code, id, result }` validates and stores in `res::<code>` list (TTL 1 h).
* Rate-limit 60 req/min per IP per code.
* Return 202 Accepted on enqueue.

## Implementation Plan
1. Add routes to `vercel.json`.
2. Implement `server/relay/post-request.ts` and `post-response.ts`.
3. Share validation schemas in `server/relay/schemas.ts`.
4. Unit tests for validation and KV enqueue.

## Verification
* Jest tests cover happy path & invalid body 400.
* End-to-end test (Task 1-5) passes.

## Files Modified
* `server/relay/post-request.ts` (new)
* `server/relay/post-response.ts` (new)
* `server/relay/schemas.ts` (new)
* `vercel.json`
* `src/test/relay/request-response.test.ts` 